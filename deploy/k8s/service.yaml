# AgoraMesh Node Services
# Exposes HTTP API and P2P ports
apiVersion: v1
kind: Service
metadata:
  name: agoramesh-node
  namespace: agoramesh
  labels:
    app.kubernetes.io/name: agoramesh-node
    app.kubernetes.io/component: service
spec:
  type: ClusterIP
  selector:
    app.kubernetes.io/name: agoramesh-node
  ports:
    - name: http
      port: 8080
      targetPort: http
      protocol: TCP
    - name: p2p
      port: 4001
      targetPort: p2p
      protocol: TCP
---
# Headless service for StatefulSet DNS (if needed for P2P discovery)
apiVersion: v1
kind: Service
metadata:
  name: agoramesh-node-headless
  namespace: agoramesh
  labels:
    app.kubernetes.io/name: agoramesh-node
    app.kubernetes.io/component: headless
spec:
  type: ClusterIP
  clusterIP: None
  selector:
    app.kubernetes.io/name: agoramesh-node
  ports:
    - name: p2p
      port: 4001
      targetPort: p2p
      protocol: TCP
---
# LoadBalancer service for external P2P access (production)
apiVersion: v1
kind: Service
metadata:
  name: agoramesh-node-p2p
  namespace: agoramesh
  labels:
    app.kubernetes.io/name: agoramesh-node
    app.kubernetes.io/component: p2p-external
  annotations:
    # For cloud providers
    # service.beta.kubernetes.io/aws-load-balancer-type: nlb
    # service.beta.kubernetes.io/azure-load-balancer-internal: "false"
spec:
  type: LoadBalancer
  selector:
    app.kubernetes.io/name: agoramesh-node
  ports:
    - name: p2p
      port: 4001
      targetPort: p2p
      protocol: TCP
