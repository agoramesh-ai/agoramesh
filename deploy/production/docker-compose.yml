services:
  node:
    image: ghcr.io/timutti/agentmesh-node:0.1.0
    command:
      - ./agentmesh
      - start
      - --enable-semantic-search
      - --api-addr
      - "0.0.0.0:8080"
      - --p2p-addr
      - /ip4/0.0.0.0/tcp/4001
    ports:
      - "127.0.0.1:8080:8080"
      - "127.0.0.1:4001:4001"
    volumes:
      - agentmesh_data:/app/data
    environment:
      - RUST_LOG=info
      - AGENTMESH_TRUST_PROXY=true
      - AGENTMESH_API_TOKEN=${AGENTMESH_API_TOKEN}
      - AGENTMESH_CORS_ORIGINS=${AGENTMESH_CORS_ORIGINS}
    restart: unless-stopped
    mem_limit: 2g

  bridge:
    image: ghcr.io/timutti/agentmesh-bridge:0.1.0
    ports:
      - "127.0.0.1:3402:3402"
    environment:
      - BRIDGE_HOST=0.0.0.0
      - NODE_ENV=production
      - BRIDGE_REQUIRE_AUTH=true
      - BRIDGE_API_TOKEN=${BRIDGE_API_TOKEN}
      - API_ENDPOINT=http://node:8080
      - AGENT_PRIVATE_KEY=${BRIDGE_AGENT_PRIVATE_KEY}
      - RPC_URL=https://sepolia.base.org
      - CHAIN_ID=84532
      - PROVIDER_DID=did:agentmesh:base-sepolia:agent-001
      - ESCROW_ADDRESS=0xD559cB432F18Dc9Fa8F2BD93d3067Cb8Ad64FdC1
      - ESCROW_RPC_URL=https://sepolia.base.org
      - ESCROW_CHAIN_ID=84532
    restart: unless-stopped
    mem_limit: 1g
    depends_on:
      - node

volumes:
  agentmesh_data:
