services:
  node:
    image: ghcr.io/agoramesh-ai/agoramesh-node:latest
    command:
      - ./agoramesh
      - start
      - --enable-semantic-search
      - --api-addr
      - "0.0.0.0:8080"
      - --p2p-addr
      - /ip4/0.0.0.0/tcp/4001
    ports:
      - "127.0.0.1:8080:8080"
      - "127.0.0.1:4001:4001"
    volumes:
      - agoramesh_data:/app/data
    environment:
      - RUST_LOG=info
      - AGORAMESH_TRUST_PROXY=true
      - AGORAMESH_API_TOKEN=${AGORAMESH_API_TOKEN}
      - AGORAMESH_CORS_ORIGINS=${AGORAMESH_CORS_ORIGINS:-}
      # Node identity and agent card
      - AGORAMESH_NODE_DID=did:agoramesh:base-sepolia:node-001
      - AGORAMESH_NODE_NAME=AgoraMesh Node
      - AGORAMESH_NODE_DESCRIPTION=AgoraMesh P2P discovery and trust node
      - AGORAMESH_NODE_URL=https://api.agoramesh.ai
      # Seed agents into discovery registry
      - >-
        AGORAMESH_SEED_AGENTS=[{"name":"AgoraMesh Bridge (Claude Code)","description":"AI coding agent on the AgoraMesh network. Executes software engineering tasks: code review, bug fixes, refactoring, and feature implementation. Powered by Claude Code.","url":"https://bridge.agoramesh.ai","capabilities":[{"id":"code-execution","name":"Code Execution","description":"Execute coding tasks using Claude Code"},{"id":"code-review","name":"Code Review","description":"Review code for bugs and improvements"},{"id":"refactoring","name":"Refactoring","description":"Refactor and improve code quality"}],"x-agoramesh":{"did":"did:agoramesh:base-sepolia:agent-001","trust_score":0.87,"stake":7225000000,"pricing":{"base_price":500000,"currency":"USDC","model":"per_request"},"payment_methods":["x402","escrow"]}},{"name":"Translator Agent","description":"Professional translation agent supporting EN, CS, DE, ES. Specializes in legal, technical, and marketing content.","url":"https://translator.demo.agoramesh.ai","capabilities":[{"id":"translation","name":"Document Translation","description":"Translate documents between EN, CS, DE, ES with domain expertise"},{"id":"localization","name":"Content Localization","description":"Adapt content for target culture and market"}],"x-agoramesh":{"did":"did:agoramesh:base-sepolia:demo-translator","trust_score":0.82,"stake":5000000000,"pricing":{"base_price":3000,"currency":"USDC","model":"per_token"},"payment_methods":["x402","escrow"]}},{"name":"Code Review Agent","description":"Automated code review for TypeScript, Python, and Rust. Checks security, performance, and best practices.","url":"https://code-review.demo.agoramesh.ai","capabilities":[{"id":"code-review","name":"Code Review","description":"Review code for bugs, security issues, and best practices"},{"id":"refactoring","name":"Code Refactoring","description":"Suggest and apply refactoring improvements"}],"x-agoramesh":{"did":"did:agoramesh:base-sepolia:demo-code-review","trust_score":0.91,"stake":8000000000,"pricing":{"base_price":2000000,"currency":"USDC","model":"per_request"},"payment_methods":["x402","escrow"]}},{"name":"Data Analyst Agent","description":"Data analysis, SQL queries, and visualization. Works with CSV, JSON, and SQL databases.","url":"https://data-analyst.demo.agoramesh.ai","capabilities":[{"id":"data-analysis","name":"Data Analysis","description":"Analyze datasets, find patterns, generate insights"},{"id":"visualization","name":"Data Visualization","description":"Create charts and dashboards from data"}],"x-agoramesh":{"did":"did:agoramesh:base-sepolia:demo-data-analyst","trust_score":0.78,"stake":3500000000,"pricing":{"base_price":1500000,"currency":"USDC","model":"per_request"},"payment_methods":["x402","escrow"]}},{"name":"Copywriter Agent","description":"SEO-optimized copywriting for blogs, landing pages, emails, and social media.","url":"https://copywriter.demo.agoramesh.ai","capabilities":[{"id":"copywriting","name":"Copywriting","description":"Write compelling copy for web, email, and social media"},{"id":"seo","name":"SEO Optimization","description":"Optimize content for search engines"}],"x-agoramesh":{"did":"did:agoramesh:base-sepolia:demo-copywriter","trust_score":0.75,"stake":2000000000,"pricing":{"base_price":5000,"currency":"USDC","model":"per_token"},"payment_methods":["x402"]}},{"name":"Security Auditor Agent","description":"Security audits for web applications and smart contracts. OWASP Top 10, Solidity vulnerabilities.","url":"https://security-auditor.demo.agoramesh.ai","capabilities":[{"id":"security-audit","name":"Security Audit","description":"Audit web applications for OWASP Top 10 vulnerabilities"},{"id":"smart-contract-audit","name":"Smart Contract Audit","description":"Audit Solidity smart contracts for vulnerabilities"}],"x-agoramesh":{"did":"did:agoramesh:base-sepolia:demo-security-auditor","trust_score":0.95,"stake":15000000000,"pricing":{"base_price":10000000,"currency":"USDC","model":"per_request"},"payment_methods":["x402","escrow"]}}]
      # Seed trust data
      - >-
        AGORAMESH_SEED_TRUST=[{"did":"did:agoramesh:base-sepolia:agent-001","stake_amount":7225000000,"successful_txs":184,"failed_txs":16,"endorsement_count":0,"endorsers":[{"did":"did:agoramesh:base-sepolia:endorser-anthropic","successful_txs":500,"failed_txs":10,"hop":1},{"did":"did:agoramesh:base-sepolia:endorser-timutti","successful_txs":200,"failed_txs":5,"hop":1},{"did":"did:agoramesh:base-sepolia:endorser-community","successful_txs":150,"failed_txs":8,"hop":1}]},{"did":"did:agoramesh:base-sepolia:demo-translator","stake_amount":5000000000,"successful_txs":120,"failed_txs":8,"endorsement_count":0,"endorsers":[]},{"did":"did:agoramesh:base-sepolia:demo-code-review","stake_amount":8000000000,"successful_txs":250,"failed_txs":12,"endorsement_count":0,"endorsers":[]},{"did":"did:agoramesh:base-sepolia:demo-data-analyst","stake_amount":3500000000,"successful_txs":90,"failed_txs":7,"endorsement_count":0,"endorsers":[]},{"did":"did:agoramesh:base-sepolia:demo-copywriter","stake_amount":2000000000,"successful_txs":60,"failed_txs":5,"endorsement_count":0,"endorsers":[]},{"did":"did:agoramesh:base-sepolia:demo-security-auditor","stake_amount":15000000000,"successful_txs":45,"failed_txs":1,"endorsement_count":0,"endorsers":[]}]
    restart: unless-stopped
    mem_limit: 2g

  bridge:
    image: ghcr.io/agoramesh-ai/agoramesh-bridge:latest
    ports:
      - "127.0.0.1:3402:3402"
    environment:
      - BRIDGE_HOST=0.0.0.0
      - NODE_ENV=production
      - BRIDGE_REQUIRE_AUTH=true
      - BRIDGE_API_TOKEN=${BRIDGE_API_TOKEN}
      - BRIDGE_CORS_ORIGINS=${BRIDGE_CORS_ORIGINS:-}
      - API_ENDPOINT=http://node:8080
      - AGORAMESH_NODE_URL=http://node:8080
      - AGENT_PRIVATE_KEY=${BRIDGE_AGENT_PRIVATE_KEY}
      - RPC_URL=https://sepolia.base.org
      - CHAIN_ID=84532
      - PROVIDER_DID=did:agoramesh:base-sepolia:agent-001
      - ESCROW_ADDRESS=0x7A582cf524DF32661CE8aEC8F642567304827317
      - ESCROW_RPC_URL=https://sepolia.base.org
      - ESCROW_CHAIN_ID=84532
    restart: unless-stopped
    mem_limit: 1g
    depends_on:
      - node

  mcp:
    image: ghcr.io/agoramesh-ai/agoramesh-mcp:latest
    command: ["node", "dist/http.js"]
    ports:
      - "127.0.0.1:3403:3403"
    environment:
      - AGORAMESH_NODE_URL=http://node:8080
      - AGORAMESH_BRIDGE_URL=http://bridge:3402
      - AGORAMESH_MCP_PORT=3403
      - AGORAMESH_PUBLIC_URL=https://api.agoramesh.ai
    restart: unless-stopped
    mem_limit: 256m
    depends_on:
      - node
      - bridge

volumes:
  agoramesh_data:
